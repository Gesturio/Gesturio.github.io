var app,dictionary,init;init=function($scope){var visualizeHand;return Leap.loop(),visualizeHand=function(controller){var camera,overlay;return controller.use("playback",{recording:"pinch-bones-3-57fps.json.lz",timeBetweenLoops:1e3,pauseOnHand:!0}).on("riggedHand.meshAdded",function(handMesh,leapHand){return handMesh.material.opacity=.7}),overlay=controller.plugins.playback.player.overlay,overlay.style.left=0,overlay.style.top="auto",overlay.style.padding=0,overlay.style.bottom="13px",overlay.style.width="180px",controller.use("riggedHand",{scale:1.3}),camera=controller.plugins.riggedHand.camera,camera.position.set(0,10,-30),camera.lookAt(new THREE.Vector3(5,5,0))},visualizeHand(Leap.loopController),function($){var _deb_senddata,_throttle_apply,capture,cooloff,gesture,gestureParams,i,l,m,meanGesture,queue,rezizeCanvas,sendData,stat;return rezizeCanvas=function(){var canvas_width;return canvas_width=$(".visualizer-container").width(),$("canvas").width(canvas_width),$("canvas").height(.8*canvas_width)},queue=[],meanGesture=function(gesture){var i;if(queue.push(gesture),20===queue.length){for(i in queue)if(queue[i]!==gesture){gesture="?";break}return queue.shift(),gesture}},sendData=function(url,data){return $.ajax({url:url,data:{data:data,gesture:gesture},success:function(){return i++%20===0?console.log(i+' Ok "'+gesture+'"'):void 0}})},capture=function(data){return sendData("/node/store",data)},stat=function(input){var data,i;data=void 0,i=void 0,data=[gesture];for(i in input)data.push(input[i]);return sendData("/node/statistic",data)},$("#visualizer").append($("canvas")),rezizeCanvas(),$(window).resize(function(){return rezizeCanvas()}),gestureParams={Gesture:{}},gesture="_",i=1,console.log(gesture),queue=[],$(document).on("keyup",function(e){return 18===e.keyCode?capture(Gesture.getParamsArray()):void 0}).on("keyup",function(e){return 32===e.keyCode?stat(Gesture.getParamsArray()):void 0}),cooloff=15,_deb_senddata=_.debounce(function(data){return stat(data)},cooloff),m=0,l="_",_throttle_apply=_.throttle(function(){return l!==gestureParams.Gesture.fuzzy?(l=gestureParams.Gesture.fuzzy,m=0):(m++,5===m?($scope.recognized=gestureParams.Gesture.fuzzy,$scope.$apply(),console.log("apply ",gestureParams.Gesture.fuzzy)):void 0)},50),Leap.loop(function(frame){var decision,hand;if(frame.hands[0]){hand=frame.hands[0],Gesture.getGestureParams(hand),Gesture.getMetrics(Gesture.getParamsArray()),decision=Gesture.makeDecision();for(i in decision)gestureParams.Gesture[i]=decision[i].name;return _throttle_apply()}})}(jQuery)},dictionary=["МАМА","ТЕСТ","ПРИВЕТ"],app=angular.module("app",["ngRoute"]),app.config(function($routeProvider){var rp;return rp=$routeProvider,rp.when("/",{name:"index",templateUrl:"views/front.html",controller:"IndexCtrl"}),rp.when("/main",{name:"index",templateUrl:"views/main.html",controller:"MainCtrl"})}),app.controller("IndexCtrl",function($rootScope,$scope,$location){return init($scope),$scope.ctrlname="index",$scope.recognized="_",$scope.$watch("recognized",function(x){return"_"!==x?$location.path("main"):void 0}),$rootScope.done=!0,$rootScope.loaded="loaded"}),app.controller("MainCtrl",function($rootScope,$scope){var i;return init($scope),$scope.languages=[{label:"English",dictionary:"en"},{label:"Russian",dictionary:"ru"}],$scope.score=0,$scope.cur_lang=$scope.languages[0],$scope.alphabet=GesturesSets.en,Gesture.GesturesSet=$scope.alphabet,$scope.set_lang=function(lang){return $scope.cur_lang=lang,$scope.alphabet=GesturesSets[$scope.cur_lang.dictionary],Gesture.GesturesSet=$scope.alphabet},i=0,$scope.new_word=function(){return $scope.word=dictionary[Math.floor(Math.random()*dictionary.length)].split("").map(function(x){return{name:x,status:""}}),$scope.word[0].status="current",i=0},$scope.new_word(),$scope.$watch("recognized",function(x){return $scope.word=$scope.word||[],x!==$scope.word[i].name?$scope.word[i].status="wrong":($scope.word[i].status="correct",i++,$scope.score++,i===$scope.word.length?setTimeout(function(){return $scope.new_word(),$scope.$apply()},1e3):void 0)}),$rootScope.loaded="loaded"}),angular.bootstrap(document,["app"]);