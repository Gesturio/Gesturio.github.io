var app,dictionary,init,params;dictionary={ru:["МАМА","ТЕСТ","ПРИВЕТ","АВГУСТ","АВОСЬ","АЗОТ","АВЕНЮ","АНГЕЛ","ВЕРСТА","ВЕСЫ","ВОЛЬЕР","ВОКАЛ","ВОКЗАЛ","ВОЛНА","ВОР","ВОПЛЬ","ВОСЕМЬ","АВТО","АМПЕР","ВЕНЧАТЬ","ВЕРТУШКА","ВЗМЫТЬ","ВЖАТЬСЯ","КАШЕЛЬ","КАРУСЕЛЬ","КАРТОН","КАПЕРСЫ","ЗРАЧОК","ЗАНЯТО","ЗАНЯТЬ","ЗАГНУТЬ","КАМЗОЛ","КАЛЬЯН","ГОСТЬЯ","ОКРУГ","ОМЛЕТ","НУТРО","ОКУЛЯР","МЯСКО","МЕШОК","МЕТРО","ЛЕСТЬ","КОНЮХ","ЗРЕЛОСТЬ","МОНСТР","МОЛЧУН","ПОЛЫМЯ","ПОЧЕТ","ШНУРОВКА","ПЛАСТЫРЬ","СУМОЧКА","ЧОКАНЬЕ","ПЛАНШЕТ","ЖУРНАЛ","УТЕЧКА","ЗАТВОР","ПЛАМЯ","ЛОМКА","ПОЧТА","ХОЛСТ","ШАЛУНЬЯ","ЭКЗАМЕН","ПОВЕСТКА","СВЕТОМУЗЫКА","СТУПЕНЬКА","ЛЕСОПАРК","КОМПЬЮТЕР"],en:["BACKLIGHT","BLACKOUT","DAYLIGHT","COBALT","COW","GOTHIC","HOBBY","HICKUP","POLICY","PUBLIC","QUOTA","AUDIO","AUDIT","HOLIDAY","DOUGHTY","DIABLO","DIALOG","QUAHOG","QUICKY","QUEUE","BLACK","BLOCK","POLYACID","TABLOID","BACKLOG","CAPITOL","JAIL","GLIB","YOGA","AGO","GABY","PATY","FOCAL","FLIGHT","FLYBACK","PUBLICA","TOPIC","OPTIC"],_sandbox:[]},app=angular.module("app",["ngRoute"]),app.config(function($routeProvider){var rp;return rp=$routeProvider,rp.when("/",{templateUrl:"views/front.html",controller:"IndexCtrl"}),rp.when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}),rp.when("/sandbox",{templateUrl:"views/sandbox.html",controller:"SandboxCtrl"}),rp.when("/dev",{templateUrl:"views/dev.html",controller:"DevCtrl"})}).directive("keypressEvents",function($document,$rootScope){return{restrict:"A",link:function(){return $document.bind("keyup",function(e){return $rootScope.$broadcast("keyup",e,String.fromCharCode(e.which))})}}}).controller("IndexCtrl",function($rootScope,$scope,$location){return init($scope),$scope.recognized="_",$scope.$watch("recognized",function(x){return"_"!==x?$location.path("main"):void 0}),$rootScope.loaded="loaded"}).controller("DevCtrl",function($rootScope,$scope,$location){var _round;return init($scope),$scope.set=[],$scope.$on("keyup",function(e,a,key){return" "===key?($scope.set.push(params),$scope.$apply(),console.log(params)):void 0}),$scope.g={params:{M:[],D:[]}},_round=function(value,decimals){return Number(Math.round(value+"e"+decimals)+"e-"+decimals)},$scope.add=function(){return console.log($scope.set.length),$scope.g.params.M=$scope.set[0].map(function(x,i){var t;return t=$scope.set.reduce(function(acc,v){return acc+v[i]},0),t/=$scope.set.length,_round(t,5)}),$scope.g.params.D=$scope.set[0].map(function(x,i){var t;if(t=$scope.set.reduce(function(acc,v){return Math.pow(v[i]-$scope.g.params.M[i],2)},0),t/=$scope.set.length,.001>t)for(;.001>t;)t*=10;return _round(t,5)}),GesturesSets._sandbox.unshift($scope.g),$scope.set=[],console.log(JSON.stringify($scope.g.params)),$location.path("/sandbox")},$rootScope.loaded="loaded"}).controller("SandboxCtrl",function($rootScope,$scope,$location){return init($scope),$scope.cur_lang="_sandbox",$scope.alphabet=GesturesSets._sandbox,Gesture.GesturesSet=$scope.alphabet,$scope.$watch("recognized",function(x){return console.log(x)}),$rootScope.loaded="loaded"}).controller("MainCtrl",function($rootScope,$scope,$location){return init($scope),$scope.languages=[{label:"American",dictionary:"en"},{label:"Russian",dictionary:"ru"},{label:"Sandbox (dev mode)",dictionary:"_sandbox"}],$scope.score=0,$scope.cur_lang=$scope.languages[0],$scope.alphabet=GesturesSets.en,Gesture.GesturesSet=$scope.alphabet,$scope.$watch("cur_lang",function(lang){return"_sandbox"===lang.dictionary&&$location.path("sandbox"),$scope.alphabet=GesturesSets[lang.dictionary],Gesture.GesturesSet=$scope.alphabet,$scope.new_word()}),$scope.new_word=function(){var nw;for($scope.i=0,$scope.word=nw=dictionary[$scope.cur_lang.dictionary][Math.floor(Math.random()*dictionary[$scope.cur_lang.dictionary].length)].split("").map(function(x){return{name:x,status:""}});nw!==$scope.word;)nw=dictionary[$scope.cur_lang.dictionary][Math.floor(Math.random()*dictionary[$scope.cur_lang.dictionary].length)].split("").map(function(x){return{name:x,status:""}});return $scope.word=nw,$scope.word[0].status="current"},$scope.new_word(),$scope.$watch("recognized",function(x){return $scope.word=$scope.word||[],x===$scope.word[$scope.i].name?($scope.word[$scope.i].status="correct",$scope.score++,$scope.i++,$scope.i>=$scope.word.length?setTimeout(function(){return $scope.new_word(),$scope.$apply()},1e3):$scope.word[$scope.i].status="current"):void 0}),$rootScope.loaded="loaded"}),params=[],init=function($scope){var l,m;return m=0,l="_",$scope.set=[],Leap.loop(function(frame){var _throttle_apply,decision;return _throttle_apply=_.throttle(function(name){return l!==name?(l=name,m=0):(m++,9===m?($scope.recognized=name,$scope.$apply(),console.log("Recognize: ",name)):void 0)},20),frame.hands[0]?(Gesture.getGestureParams(frame.hands[0]),params=Gesture.getParamsArray(),Gesture.getMetrics(params),decision=Gesture.makeDecision(),_throttle_apply(decision.name)):void 0}),function(controller){var camera,canvas,overlay,visualizer;return controller.use("playback",{timeBetweenLoops:1e4,pauseOnHand:!0}).on("riggedHand.meshAdded",function(handMesh,leapHand){return handMesh.material.opacity=.9}),overlay=controller.plugins.playback.player.overlay,overlay.style.left=0,overlay.style.top="auto",overlay.style.padding=0,overlay.style.bottom="13px",overlay.style.width="180px",controller.use("riggedHand",{scale:1.5}),camera=controller.plugins.riggedHand.camera,camera.position.set(7,10,-30),camera.lookAt(new THREE.Vector3(7,10,0)),canvas=document.getElementsByTagName("canvas")[0],visualizer=document.getElementById("visualizer"),visualizer?(canvas.style.width=visualizer.clientWidth+"px",canvas.style.height=visualizer.clientHeight+"px",canvas.style.top=visualizer.offsetTop+"px",canvas.style.left=visualizer.offsetLeft+"px"):(canvas.style.width=0,canvas.style.height=0)}(Leap.loopController)},angular.bootstrap(document,["app"]);